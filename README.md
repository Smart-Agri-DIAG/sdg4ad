# Synthetic Data Generation for Anomaly Detection on Table Grapes

This repository contains the code and resources for our research paper **"Synthetic data generation for anomaly detection on table grapes"**. Our approach focuses on automatically generating synthetic anomalous samples to improve anomaly detection in table grape cultivation, with potential applications in broader precision agriculture contexts.

## Overview

Early detection of illnesses and pest infestations is critical in fruit cultivation. In this work, we propose a method that automatically generates synthetic anomalies by using a combination of image segmentation and a novel Dual-Canny Edge Detection (DCED) filter. The DCED filter emphasizes complex textures, which often indicate defects, such as diseases or pest infestations. The approach leverages segmentation masks generated by the Segment Anything Model to seamlessly blend anomalous berries onto otherwise normal samples.

## Repository Structure

- **src/**: Contains Python scripts and modules for synthetic data generation and the anomaly detection pipeline.
- **config/**: Contains configuration files for experiments and pipeline parameters.
- **data/**: Stores datasets, dataset splits, and generated synthetic images.
- **notebooks/**: Includes Jupyter Notebooks for visualizing the synthetic image generation process and generating figures for the paper.

## Dataset
Download the dataset from the following [link](https://drive.google.com/drive/folders/1eKK0O3rVdAMoA8Fn-3xd5gmGS9jf-nbT?usp=sharing) and place the content inside **data/**.

## How to Use

1. **Clone the Repository:**

   ```bash
   git clone https://github.com/Smart-Agri-DIAG/sdg4ad.git
   cd sdg4ad
   ```

2. **Install Dependencies:**

   ```bash
   pip install -r requirements.txt
   ```

3. **Compute DCED Parameters:**

   Run the parameter computation script:

   ```bash
   python src/compute_dced_params.py
   ```

4. **Generate Synthetic Images:**

   Use the computed parameters to run the synthetic image generation:

   ```bash
   python src/generate_synthetic_images.py
   ```

5. **Train the Anomaly Detection Model:**

   Execute the training script:

   ```bash
   python train.py
   ```

Please note that the configuration files and paths in the scripts may need to be adapted for other datasets. Additionally, the split generation scripts might require adjustments for new paths and splits. In the paper, we used 3 splits (train/val) generated with 3 different seeds.

## Paper Details

This project accompanies our paper published in *Smart Agricultural Technology*:

- **Title:** Synthetic data generation for anomaly detection on table grapes  
- **Volume:** 10  
- **Pages:** 100787  
- **Year:** 2025  
- **ISSN:** 2772-3755  
- **DOI:** [10.1016/j.atech.2025.100787](https://doi.org/10.1016/j.atech.2025.100787)  
- **URL:** [ScienceDirect Article](https://www.sciencedirect.com/science/article/pii/S2772375525000218)

### BibTeX Citation

If you find this project useful in your research, please use the following BibTeX entry:

```bibtex
@article{MOTOI2025100787,
title = {Synthetic data generation for anomaly detection on table grapes},
journal = {Smart Agricultural Technology},
volume = {10},
pages = {100787},
year = {2025},
issn = {2772-3755},
doi = {https://doi.org/10.1016/j.atech.2025.100787},
url = {https://www.sciencedirect.com/science/article/pii/S2772375525000218},
author = {Ionut M. Motoi and Valerio Belli and Alberto Carpineto and Daniele Nardi and Thomas A. Ciarfuglia},
keywords = {Precision agriculture, Segmentation, Anomaly detection, Synthetic data},
}
```

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

## Contact

For any questions or further information, please contact [Thomas A. Ciarfuglia](mailto:ciarfuglia@diag.uniroma1.it).

---